const translations = {
    en: {
        nav_home: "Home",
        nav_about: "About Us",
        nav_services: "Services",
        nav_shop: "Shop",
        nav_contact: "Contact",
        hero_title: "Precision Metal & <br> <span class='highlight'>Office Solutions</span>",
        hero_desc: "From industrial CNC parts to premium steel office furniture. Quality manufacturing made in Cambodia.",
        btn_shop: "Shop Products",
        btn_quote: "Request Quote",
        feat_title: "What We Do",
        feat_sub: "Our Core Specialties",
        feat_off: "Office Furniture",
        feat_off_desc: "Modern desks, cabinets, and storage.",
        btn_view_cat: "View Catalog <i class='fa-solid fa-arrow-right'></i>",
        feat_ind: "Industrial Parts",
        feat_ind_desc: "CNC machining and custom metal fabrication.",
        btn_learn: "Learn More <i class='fa-solid fa-arrow-right'></i>",
        cta_title: "Looking for Custom Fabrication?",
        cta_desc: "We handle bulk orders for offices and industrial projects.",
        btn_contact: "Contact Us Today",
        footer_desc: "Professional metal fabrication and engineering solutions tailored for the Cambodian market.",
        footer_quick: "Quick Links",
        footer_contact: "Contact",
        footer_copy: "&copy; 2025 LittleMaker Cambodia. All Rights Reserved.",
        
        // About Page
        about_header: "About Our Company",
        about_sub: "Leading the way in Cambodian Manufacturing",
        about_who: "Who We Are",
        about_title: "Leading Metal Solutions in Cambodia",
        about_p1: "LITTLEMAKER CAMBODIA is a premier manufacturing partner specializing in high-quality metal components and modern office furniture. We combine local expertise with international manufacturing standards.",
        about_p2: "Whether you need custom enclosures, heavy machinery parts, or delicate architectural metalwork, our team of engineers ensures perfection in every weld and cut.",
        feat_iso: "ISO 9001 Compliant Processes",
        feat_high: "High Quality Office Furniture",
        feat_fast: "Fast Delivery in Phnom Penh",
        stat_eng: "Skilled Engineers",
        stat_proj: "Projects Completed",
        stat_exp: "Industry Experience",

        // Services Page
        serv_header: "Our Capabilities",
        serv_sub: "Advanced Technology Meets Skilled Craftsmanship",
        serv_cnc: "CNC Machining",
        serv_cnc_desc: "High-precision milling and turning for complex geometries using steel, aluminum, and brass.",
        serv_laser: "Laser Cutting",
        serv_laser_desc: "State-of-the-art fiber laser cutting for sheet metal with clean edges and tight tolerances.",
        serv_weld: "Welding & Fab",
        serv_weld_desc: "MIG, TIG, and Spot welding services by certified welders for structural integrity.",
        serv_finish: "Finishing",
        serv_finish_desc: "Powder coating, anodizing, and galvanizing to ensure durability and aesthetic appeal.",
        serv_cad: "CAD Design",
        serv_cad_desc: "Professional engineering design services to turn your concept sketches into manufacturing-ready blueprints.",
        serv_ass: "Assembly",
        serv_ass_desc: "Full product assembly and packaging services for retail-ready delivery.",

        // Products Page
        prod_header: "Product Catalog",
        prod_sub: "Quality Tables, Cabinets & Grills",
        search_ph: "Search products...",
        filter_all: "All",
        filter_tables: "Tables",
        filter_cabinets: "Cabinets",
        filter_grills: "Grills",
        prod_1_title: "Modern Executive Desk",
        prod_1_desc: "Minimalist steel frame desk with wooden top.",
        prod_2_title: "Steel File Cabinet (3-Drawer)",
        prod_2_desc: "Secure storage with locking mechanism.",
        prod_3_title: "Conference Table (8 Seats)",
        prod_3_desc: "Durable metal legs with glass or wood top.",
        prod_4_title: "Premium BBQ Grill Stand",
        prod_4_desc: "Heavy duty steel charcoal grill for outdoor parties.",
        prod_5_title: "Industrial Metal Locker",
        prod_5_desc: "Single door locker for workshop or gym.",
        prod_6_title: "Portable Camping Stove",
        prod_6_desc: "Compact stainless steel stove for travel.",
        btn_add: "<i class='fa-solid fa-cart-plus'></i> Add",

        // Contact Page
        cont_header: "Contact Us",
        cont_sub: "Get a Quote or Ask a Question",
        cont_touch: "Get In Touch",
        cont_ready: "Ready to Start Your Project?",
        cont_desc: "Contact us today for a free consultation or bulk order quote. We respond within 24 hours.",
        ph_name: "Your Name",
        ph_email: "Your Email",
        ph_subj: "Subject / Product Inquiry",
        ph_msg: "Project Details or Order Request",
        btn_send: "Send Message",
        cont_email: "Email",
        cont_fb: "Facebook",
        cont_tg: "Telegram",
        cont_phone: "Phone",
        cont_loc: "Location"
    },
    kh: {
        nav_home: "ទំព័រដើម",
        nav_about: "អំពីយើង",
        nav_services: "សេវាកម្ម",
        nav_shop: "ហាង",
        nav_contact: "ទំនាក់ទំនង",
        hero_title: "លោហៈភាពជាក់លាក់ & <br> <span class='highlight'>ដំណោះស្រាយការិយាល័យ</span>",
        hero_desc: "ពីគ្រឿងបន្លាស់ CNC ឧស្សាហកម្ម រហូតដល់គ្រឿងសង្ហារឹមការិយាល័យដែកលំដាប់ខ្ពស់។ ផលិតកម្មគុណភាពផលិតនៅកម្ពុជា។",
        btn_shop: "ទិញផលិតផល",
        btn_quote: "ស្នើសុំតម្លៃ",
        feat_title: "អ្វីដែលយើងធ្វើ",
        feat_sub: "ជំនាញស្នូលរបស់យើង",
        feat_off: "គ្រឿងសង្ហារឹមការិយាល័យ",
        feat_off_desc: "តុ ទូ និងកន្លែងផ្ទុកទំនើប។",
        btn_view_cat: "មើលកាតាឡុក <i class='fa-solid fa-arrow-right'></i>",
        feat_ind: "គ្រឿងបន្លាស់ឧស្សាហកម្ម",
        feat_ind_desc: "ម៉ាស៊ីន CNC និងការផលិតដែកតាមតម្រូវការ។",
        btn_learn: "ស្វែងយល់បន្ថែម <i class='fa-solid fa-arrow-right'></i>",
        cta_title: "ស្វែងរកការផលិតតាមតម្រូវការ?",
        cta_desc: "យើងទទួលការបញ្ជាទិញជាដុំសម្រាប់គម្រោងការិយាល័យនិងឧស្សាហកម្ម។",
        btn_contact: "ទាក់ទងមកយើងថ្ងៃនេះ",
        footer_desc: "ដំណោះស្រាយផលិតកម្មលោហៈនិងវិស្វកម្មដែលមានវិជ្ជាជីវៈសម្រាប់ទីផ្សារកម្ពុជា។",
        footer_quick: "តំណរហ័ស",
        footer_contact: "ទំនាក់ទំនង",
        footer_copy: "&copy; 2025 LittleMaker Cambodia. រក្សាសិទ្ធិគ្រប់យ៉ាង។",

        // About Page
        about_header: "អំពីក្រុមហ៊ុនរបស់យើង",
        about_sub: "នាំមុខក្នុងវិស័យផលិតកម្មកម្ពុជា",
        about_who: "យើងជានរណា",
        about_title: "ដំណោះស្រាយលោហៈឈានមុខគេនៅកម្ពុជា",
        about_p1: "LITTLEMAKER CAMBODIA គឺជាដៃគូផលិតកម្មឈានមុខគេដែលមានឯកទេសលើសមាសធាតុលោហៈដែលមានគុណភាពខ្ពស់ និងគ្រឿងសង្ហារឹមការិយាល័យទំនើប។ យើងរួមបញ្ចូលជំនាញក្នុងស្រុកជាមួយស្តង់ដារផលិតកម្មអន្តរជាតិ។",
        about_p2: "មិនថាអ្នកត្រូវការប្រអប់តាមតម្រូវការ គ្រឿងបន្លាស់ម៉ាស៊ីនធុនធ្ងន់ ឬការងារលោហៈស្ថាបត្យកម្មដ៏ល្អិតល្អន់ ក្រុមវិស្វកររបស់យើងធានានូវភាពល្អឥតខ្ចោះក្នុងរាល់ការផ្សារនិងការកាត់។",
        feat_iso: "ដំណើរការអនុលោមតាម ISO 9001",
        feat_high: "គ្រឿងសង្ហារឹមការិយាល័យគុណភាពខ្ពស់",
        feat_fast: "ដឹកជញ្ជូនរហ័សក្នុងរាជធានីភ្នំពេញ",
        stat_eng: "វិស្វករជំនាញ",
        stat_proj: "គម្រោងបានបញ្ចប់",
        stat_exp: "បទពិសោធន៍ក្នុងឧស្សាហកម្ម",

        // Services Page
        serv_header: "សមត្ថភាពរបស់យើង",
        serv_sub: "បច្ចេកវិទ្យាជឿនលឿនជួបជាមួយសិល្បៈហត្ថកម្មដ៏ជំនាញ",
        serv_cnc: "ម៉ាស៊ីន CNC",
        serv_cnc_desc: "ការកិននិងការក្រឡឹងដែលមានភាពជាក់លាក់ខ្ពស់សម្រាប់ធរណីមាត្រស្មុគស្មាញដោយប្រើដែក អាលុយមីញ៉ូម និងស្ពាន់។",
        serv_laser: "ការកាត់ឡាស៊ែរ",
        serv_laser_desc: "ការកាត់ឡាស៊ែរហ្វាយប៊ឺដ៏ទំនើបសម្រាប់សន្លឹកដែកដែលមានគែមស្អាតនិងកម្រិតភាពជាក់លាក់ខ្ពស់។",
        serv_weld: "ការផ្សារ & ផលិតកម្ម",
        serv_weld_desc: "សេវាកម្មផ្សារ MIG, TIG និង Spot ដោយជាងផ្សារដែលមានវិញ្ញាបនបត្រសម្រាប់សុចរិតភាពរចនាសម្ព័ន្ធ។",
        serv_finish: "ការបញ្ចប់",
        serv_finish_desc: "ការបាញ់ថ្នាំម្សៅ, anodizing និង galvanizing ដើម្បីធានាបាននូវភាពធន់និងសោភ័ណភាព។",
        serv_cad: "ការរចនា CAD",
        serv_cad_desc: "សេវាកម្មរចនាវិស្វកម្មដែលមានវិជ្ជាជីវៈដើម្បីប្រែក្លាយគំនូរព្រាងរបស់អ្នកទៅជាប្លង់ផលិតកម្ម។",
        serv_ass: "ការដំឡើង",
        serv_ass_desc: "សេវាកម្មដំឡើងផលិតផលពេញលេញនិងការវេចខ្ចប់សម្រាប់ការដឹកជញ្ជូនលក់រាយ។",

        // Products Page
        prod_header: "កាតាឡុកផលិតផល",
        prod_sub: "តុ ទូ និងចង្ក្រានគុណភាព",
        search_ph: "ស្វែងរកផលិតផល...",
        filter_all: "ទាំងអស់",
        filter_tables: "តុ",
        filter_cabinets: "ទូ",
        filter_grills: "ចង្ក្រានអាំង",
        prod_1_title: "តុការិយាល័យទំនើប",
        prod_1_desc: "តុដែកដែលមានស៊ុមដែកនិងផ្ទៃខាងលើឈើ។",
        prod_2_title: "ទូឯកសារដែក (៣ ថត)",
        prod_2_desc: "ការផ្ទុកមានសុវត្ថិភាពជាមួយយន្តការចាក់សោ។",
        prod_3_title: "តុប្រជុំ (៨ កៅអី)",
        prod_3_desc: "ជើងដែកជាប់ធន់ជាមួយផ្ទៃកញ្ចក់ឬឈើ។",
        prod_4_title: "ចង្ក្រានអាំងសាច់ធុនធ្ងន់",
        prod_4_desc: "ចង្ក្រានធ្យូងដែកធុនធ្ងន់សម្រាប់ការជប់លៀងក្រៅផ្ទះ។",
        prod_5_title: "ទូដាក់សម្ភារៈឧស្សាហកម្ម",
        prod_5_desc: "ទូទ្វារតែមួយសម្រាប់រោងជាងឬកន្លែងហាត់ប្រាណ។",
        prod_6_title: "ចង្ក្រានបោះជំរុំចល័ត",
        prod_6_desc: "ចង្ក្រានដែកអ៊ីណុកតូចសម្រាប់ការធ្វើដំណើរ។",
        btn_add: "<i class='fa-solid fa-cart-plus'></i> បញ្ចូល",

        // Contact Page
        cont_header: "ទាក់ទងមកយើង",
        cont_sub: "ទទួលតម្លៃឬសួរសំណួរ",
        cont_touch: "ទំនាក់ទំនង",
        cont_ready: "ត្រៀមខ្លួនចាប់ផ្តើមគម្រោងរបស់អ្នកហើយឬនៅ?",
        cont_desc: "ទាក់ទងមកយើងថ្ងៃនេះសម្រាប់ការពិគ្រោះយោបល់ដោយឥតគិតថ្លៃឬសម្រង់តម្លៃការបញ្ជាទិញជាដុំ។ យើងឆ្លើយតបក្នុងរយៈពេល ២៤ ម៉ោង។",
        ph_name: "ឈ្មោះរបស់អ្នក",
        ph_email: "អ៊ីមែលរបស់អ្នក",
        ph_subj: "ប្រធានបទ / ការសាកសួរផលិតផល",
        ph_msg: "ព័ត៌មានលម្អិតគម្រោងឬសំណើបញ្ជាទិញ",
        btn_send: "ផ្ញើសារ",
        cont_email: "អ៊ីមែល",
        cont_fb: "ហ្វេសប៊ុក",
        cont_tg: "តេឡេក្រាម",
        cont_phone: "ទូរស័ព្ទ",
        cont_loc: "ទីតាំង"
    },
    cn: {
        nav_home: "首页",
        nav_about: "关于我们",
        nav_services: "服务",
        nav_shop: "商店",
        nav_contact: "联系",
        hero_title: "精密金属与 <br> <span class='highlight'>办公解决方案</span>",
        hero_desc: "从工业CNC零件到优质钢制办公家具。柬埔寨制造的优质产品。",
        btn_shop: "购买产品",
        btn_quote: "询价",
        feat_title: "我们做什么",
        feat_sub: "我们的核心专长",
        feat_off: "办公家具",
        feat_off_desc: "现代办公桌、文件柜和存储设备。",
        btn_view_cat: "查看目录 <i class='fa-solid fa-arrow-right'></i>",
        feat_ind: "工业零件",
        feat_ind_desc: "CNC加工和定制金属制造。",
        btn_learn: "了解更多 <i class='fa-solid fa-arrow-right'></i>",
        cta_title: "寻找定制制造？",
        cta_desc: "我们处理办公室和工业项目的批量订单。",
        btn_contact: "立即联系我们",
        footer_desc: "专为柬埔寨市场定制的专业金属制造和工程解决方案。",
        footer_quick: "快速链接",
        footer_contact: "联系方式",
        footer_copy: "&copy; 2025 LittleMaker Cambodia. 版权所有。",

        // About Page
        about_header: "关于我们公司",
        about_sub: "引领柬埔寨制造业",
        about_who: "我们是谁",
        about_title: "柬埔寨领先的金属解决方案",
        about_p1: "LITTLEMAKER CAMBODIA 是首屈一指的制造合作伙伴，专注于高质量的金属部件和现代办公家具。我们将本地专业知识与国际制造标准相结合。",
        about_p2: "无论您需要定制外壳、重型机械零件还是精细的建筑金属制品，我们的工程师团队都能确保每一次焊接和切割的完美。",
        feat_iso: "符合 ISO 9001 标准的流程",
        feat_high: "高品质办公家具",
        feat_fast: "金边市内快速配送",
        stat_eng: "熟练工程师",
        stat_proj: "完成的项目",
        stat_exp: "行业经验",

        // Services Page
        serv_header: "我们的能力",
        serv_sub: "先进技术遇上精湛工艺",
        serv_cnc: "CNC 加工",
        serv_cnc_desc: "使用钢、铝和黄铜进行高精度铣削和车削，用于复杂的几何形状。",
        serv_laser: "激光切割",
        serv_laser_desc: "最先进的光纤激光切割，用于钣金，边缘整洁，公差严格。",
        serv_weld: "焊接与制造",
        serv_weld_desc: "由认证焊工提供的MIG、TIG和点焊服务，确保结构完整性。",
        serv_finish: "表面处理",
        serv_finish_desc: "粉末涂层、阳极氧化和镀锌，以确保耐用性和美观。",
        serv_cad: "CAD 设计",
        serv_cad_desc: "专业的工程设计服务，将您的概念草图转化为生产蓝图。",
        serv_ass: "组装",
        serv_ass_desc: "完整的产品组装和包装服务，适合零售交付。",

        // Products Page
        prod_header: "产品目录",
        prod_sub: "优质桌子、柜子和烤架",
        search_ph: "搜索产品...",
        filter_all: "全部",
        filter_tables: "桌子",
        filter_cabinets: "柜子",
        filter_grills: "烤架",
        prod_1_title: "现代行政办公桌",
        prod_1_desc: "极简钢架办公桌，配木质桌面。",
        prod_2_title: "钢制文件柜（3抽屉）",
        prod_2_desc: "带锁定机制的安全存储。",
        prod_3_title: "会议桌（8座）",
        prod_3_desc: "耐用的金属腿，配玻璃或木质桌面。",
        prod_4_title: "高级烧烤架",
        prod_4_desc: "重型钢制木炭烤架，适合户外聚会。",
        prod_5_title: "工业金属储物柜",
        prod_5_desc: "适用于车间或健身房的单门储物柜。",
        prod_6_title: "便携式露营炉",
        prod_6_desc: "紧凑型不锈钢炉，适合旅行。",
        btn_add: "<i class='fa-solid fa-cart-plus'></i> 添加",

        // Contact Page
        cont_header: "联系我们",
        cont_sub: "获取报价或提问",
        cont_touch: "取得联系",
        cont_ready: "准备好开始您的项目了吗？",
        cont_desc: "立即联系我们进行免费咨询或批量订单报价。我们在24小时内回复。",
        ph_name: "您的姓名",
        ph_email: "您的电子邮件",
        ph_subj: "主题 / 产品咨询",
        ph_msg: "项目详情或订单请求",
        btn_send: "发送信息",
        cont_email: "电子邮件",
        cont_fb: "Facebook",
        cont_tg: "Telegram",
        cont_phone: "电话",
        cont_loc: "位置"
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // --- Theme Switcher Logic ---
    const themeBtn = document.getElementById('themeBtn');
    
    const applyTheme = (theme) => {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            if(themeBtn) themeBtn.innerHTML = '<i class="fa-solid fa-sun"></i>';
        } else {
            document.body.classList.remove('dark-mode');
            if(themeBtn) themeBtn.innerHTML = '<i class="fa-solid fa-moon"></i>';
        }
    };

    const savedTheme = localStorage.getItem('lm_theme_pref') || 'light';
    applyTheme(savedTheme);

    if (themeBtn) {
        themeBtn.addEventListener('click', () => {
            const isDark = document.body.classList.contains('dark-mode');
            const newTheme = isDark ? 'light' : 'dark';
            localStorage.setItem('lm_theme_pref', newTheme);
            applyTheme(newTheme);
        });
    }

    // --- Language Switcher Logic ---
    const langBtn = document.getElementById('langBtn');
    const langMenu = document.getElementById('langMenu');
    const currentLangSpan = document.getElementById('currentLang');
    const langLinks = document.querySelectorAll('.lang-menu a');

    const updatePageContent = (lang) => {
        // Update Text Content
        document.querySelectorAll('[data-translate]').forEach(el => {
            const key = el.getAttribute('data-translate');
            if(translations[lang][key]) {
                if (translations[lang][key].includes('<')) {
                    el.innerHTML = translations[lang][key];
                } else {
                    el.textContent = translations[lang][key];
                }
            }
        });

        // Update Placeholders
        document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
             const key = el.getAttribute('data-translate-placeholder');
             if(translations[lang][key]) {
                 el.placeholder = translations[lang][key];
             }
        });
        
        // Update Button Text
        if(currentLangSpan) currentLangSpan.textContent = lang.toUpperCase();
    };

    // Load saved language
    const savedLang = localStorage.getItem('lm_lang_pref') || 'en';
    updatePageContent(savedLang);

    if (langBtn && langMenu) {
        langBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            langMenu.classList.toggle('show');
        });

        document.addEventListener('click', (e) => {
            if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
                langMenu.classList.remove('show');
            }
        });

        langLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const lang = link.getAttribute('data-lang');
                localStorage.setItem('lm_lang_pref', lang);
                updatePageContent(lang);
                langMenu.classList.remove('show');
            });
        });
    }

    // --- Mobile Menu Toggle ---
    const mobileMenuBtn = document.getElementById('mobile-menu');
    const navMenu = document.querySelector('.nav-menu');

    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            
            const bars = document.querySelectorAll('.bar');
            if (navMenu.classList.contains('active')) {
                bars[0].style.transform = 'rotate(-45deg) translate(-5px, 6px)';
                bars[1].style.opacity = '0';
                bars[2].style.transform = 'rotate(45deg) translate(-5px, -6px)';
            } else {
                bars[0].style.transform = 'none';
                bars[1].style.opacity = '1';
                bars[2].style.transform = 'none';
            }
        });
    }

    // --- Active Link Highlight ---
    const navLinks = document.querySelectorAll('.nav-link');
    const currentPath = window.location.pathname;
    const pageName = currentPath.split("/").pop() || 'index.html';

    navLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href === pageName) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });

    // --- Scroll Animation ---
    const observerOptions = { threshold: 0.1 };
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target); 
            }
        });
    }, observerOptions);

    document.querySelectorAll('.fade-in').forEach(element => {
        observer.observe(element);
    });

    // --- Sticky Header Shadow ---
    const navbar = document.querySelector('.navbar');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            navbar.style.boxShadow = '0 5px 20px rgba(0,0,0,0.15)';
        } else {
            navbar.style.boxShadow = '0 2px 10px rgba(0,0,0,0.05)';
        }
    });

    // --- Form Handling ---
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
        contactForm.addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Thank you for contacting LittleMaker Cambodia! We will get back to you shortly.');
            contactForm.reset();
        });
    }

    // --- Search Logic ---
    const searchInput = document.getElementById('productSearch');
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            const filterValue = e.target.value.toLowerCase();
            const productCards = document.querySelectorAll('.product-card');
            
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            const allBtn = document.querySelector('.filter-btn[data-filter="all"]');
            if(allBtn) allBtn.classList.add('active');

            productCards.forEach(card => {
                const title = card.querySelector('h4').textContent.toLowerCase();
                const desc = card.querySelector('.product-desc') ? card.querySelector('.product-desc').textContent.toLowerCase() : '';
                
                if (title.includes(filterValue) || desc.includes(filterValue)) {
                    card.style.display = 'block';
                    setTimeout(() => card.style.opacity = '1', 50);
                } else {
                    card.style.display = 'none';
                    card.style.opacity = '0';
                }
            });
        });
    }

    // --- Product Filtering Logic ---
    const filterBtns = document.querySelectorAll('.filter-btn');
    if (filterBtns.length > 0) {
        const productCards = document.querySelectorAll('.product-card');

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if(searchInput) searchInput.value = '';

                const filterValue = btn.getAttribute('data-filter');
                
                productCards.forEach(card => {
                    if (filterValue === 'all' || card.getAttribute('data-category') === filterValue) {
                        card.style.display = 'block';
                        setTimeout(() => card.style.opacity = '1', 50);
                    } else {
                        card.style.display = 'none';
                        card.style.opacity = '0';
                    }
                });
            });
        });
    }

    // ========================================================
    // --- SHOPPING CART, INVOICE & TELEGRAM INTEGRATION ---
    // ========================================================

    const modalsHTML = `
    <div class="cart-modal-overlay" id="cartModal">
        <div class="cart-modal">
            <div class="cart-header">
                <h3>Shopping Cart</h3>
                <span class="close-cart" id="closeCartBtn"><i class="fa-solid fa-xmark"></i></span>
            </div>
            <div class="cart-body" id="cartItems">
                <!-- Items go here -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cartTotal">$0.00</span>
                </div>
                <button class="btn btn-outline" id="viewInvBtn" style="color:var(--text-color); border-color:var(--text-muted); width:100%; margin-bottom:15px;">View Invoice</button>
                
                <div class="cart-actions">
                    <button class="social-checkout-btn btn-telegram" id="checkoutTeleg">
                        <i class="fa-brands fa-telegram"></i> Order via Telegram
                    </button>
                    <div class="dual-btns">
                        <button class="social-checkout-btn btn-facebook" id="checkoutFb">
                            <i class="fa-brands fa-facebook"></i> Facebook
                        </button>
                        <button class="social-checkout-btn btn-phone" id="checkoutPhone">
                            <i class="fa-solid fa-phone"></i> Call
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="invoice-backdrop" id="invBackdrop"></div>
    <div class="invoice-modal" id="invoiceModal">
        <div class="invoice-header">
            <div class="inv-logo">LITTLEMAKER</div>
            <div class="inv-title">INVOICE</div>
        </div>
        <div class="invoice-body" id="invoiceContent">
            <!-- Invoice Table -->
        </div>
        <div class="invoice-actions">
            <button class="btn btn-outline" id="closeInvBtn" style="color:var(--text-color); border-color:var(--text-muted);">Close</button>
            <button class="btn btn-primary" onclick="window.print()">Print</button>
        </div>
    </div>`;
    
    document.body.insertAdjacentHTML('beforeend', modalsHTML);

    let cart = JSON.parse(localStorage.getItem('lm_cart_data')) || [];
    const cartCountEls = document.querySelectorAll('.cart-badge');
    const cartModal = document.getElementById('cartModal');
    const cartItemsContainer = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const viewInvBtn = document.getElementById('viewInvBtn');
    const invoiceModal = document.getElementById('invoiceModal');
    const invBackdrop = document.getElementById('invBackdrop');
    
    const updateCartUI = () => {
        const count = cart.reduce((sum, item) => sum + item.qty, 0);
        cartCountEls.forEach(el => el.textContent = count);
        localStorage.setItem('lm_cart_data', JSON.stringify(cart));
    };

    const renderCart = () => {
        cartItemsContainer.innerHTML = '';
        let total = 0;

        if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<p style="text-align:center; margin-top: 20px; color:var(--text-muted);">Your cart is empty.</p>';
        } else {
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.qty;
                total += itemTotal;
                const itemHTML = `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <h5>${item.name}</h5>
                        <span class="cart-item-price">$${item.price.toFixed(2)}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <div class="qty-controls">
                            <button class="qty-btn minus" data-index="${index}">-</button>
                            <span class="qty-val">${item.qty}</span>
                            <button class="qty-btn plus" data-index="${index}">+</button>
                        </div>
                        <button class="remove-item" data-index="${index}">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>`;
                cartItemsContainer.insertAdjacentHTML('beforeend', itemHTML);
            });
        }

        cartTotalEl.textContent = '$' + total.toFixed(2);

        document.querySelectorAll('.qty-btn.plus').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const index = e.target.closest('button').dataset.index;
                cart[index].qty++;
                updateCartUI();
                renderCart();
            });
        });

        document.querySelectorAll('.qty-btn.minus').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const index = e.target.closest('button').dataset.index;
                if (cart[index].qty > 1) {
                    cart[index].qty--;
                } else {
                    cart.splice(index, 1);
                }
                updateCartUI();
                renderCart();
            });
        });

        document.querySelectorAll('.remove-item').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const index = e.target.closest('button').dataset.index;
                cart.splice(index, 1);
                updateCartUI();
                renderCart();
            });
        });
    };

    const addToCartBtns = document.querySelectorAll('.add-to-cart');
    addToCartBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const card = e.target.closest('.product-card');
            const name = card.querySelector('h4').textContent;
            
            let priceEl = card.querySelector('.price');
            let clone = priceEl.cloneNode(true);
            let old = clone.querySelector('.old-price');
            if(old) old.remove();
            let priceText = clone.textContent.trim().replace('$', '');
            let price = parseFloat(priceText);

            const existingItem = cart.find(item => item.name === name);

            if (existingItem) {
                existingItem.qty++;
            } else {
                const newItem = {
                    name: name,
                    price: price,
                    qty: 1
                };
                cart.push(newItem);
            }

            updateCartUI();
            
            cartCountEls.forEach(el => {
                el.classList.add('bump');
                setTimeout(() => el.classList.remove('bump'), 200);
            });
            
            showToast("Added to cart: " + name);
        });
    });

    const cartTriggers = document.querySelectorAll('.cart-trigger');
    cartTriggers.forEach(trigger => {
        trigger.addEventListener('click', (e) => {
            e.preventDefault();
            renderCart();
            cartModal.classList.add('open');
        });
    });

    document.getElementById('closeCartBtn').addEventListener('click', () => {
        cartModal.classList.remove('open');
    });

    cartModal.addEventListener('click', (e) => {
        if (e.target === cartModal) {
            cartModal.classList.remove('open');
        }
    });

    const showInvoice = () => {
        if (cart.length === 0) return;
        
        let tableHTML = `
        <table>
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th class="text-right">Qty</th>
                    <th class="text-right">Price</th>
                    <th class="text-right">Total</th>
                </tr>
            </thead>
            <tbody>`;
            
        let total = 0;
        cart.forEach(item => {
            let lineTotal = item.price * item.qty;
            total += lineTotal;
            tableHTML += `
            <tr>
                <td>${item.name}</td>
                <td class="text-right">${item.qty}</td>
                <td class="text-right">$${item.price.toFixed(2)}</td>
                <td class="text-right">$${lineTotal.toFixed(2)}</td>
            </tr>`;
        });

        tableHTML += `
            </tbody>
        </table>
        <div class="invoice-summary">
            <strong>Grand Total: $${total.toFixed(2)}</strong>
        </div>
        <p>Date: ${new Date().toLocaleDateString()}</p>`;

        document.getElementById('invoiceContent').innerHTML = tableHTML;
        invBackdrop.classList.add('open');
        invoiceModal.classList.add('open');
    };

    viewInvBtn.addEventListener('click', () => {
         if (cart.length === 0) {
            alert("Your cart is empty!");
            return;
        }
        cartModal.classList.remove('open');
        showInvoice();
    });

    const closeInvoice = () => {
        invoiceModal.classList.remove('open');
        invBackdrop.classList.remove('open');
    };

    document.getElementById('closeInvBtn').addEventListener('click', closeInvoice);
    invBackdrop.addEventListener('click', closeInvoice);

    const generateOrderMessage = () => {
        let message = "Hello LittleMaker, I would like to order:%0A%0A";
        let total = 0;
        cart.forEach((item, index) => {
            let itemTotal = item.price * item.qty;
            total += itemTotal;
            message += `${index + 1}. ${item.name} (x${item.qty}) - $${itemTotal.toFixed(2)}%0A`;
        });
        message += `%0A----------------%0ATotal: $${total.toFixed(2)}%0A%0APlease confirm my order.`;
        return message;
    };

    const checkoutTeleg = document.getElementById('checkoutTeleg');
    if(checkoutTeleg) {
        checkoutTeleg.addEventListener('click', () => {
            if (cart.length === 0) {
                alert("Your cart is empty!");
                return;
            }
            const telegramUser = "samnangkhiev";
            const url = `https://t.me/${telegramUser}?text=${generateOrderMessage()}`;
            window.open(url, '_blank');
        });
    }

    const checkoutFb = document.getElementById('checkoutFb');
    if(checkoutFb) {
        checkoutFb.addEventListener('click', () => {
             window.open('https://t.me/samnangkhiev', '_blank');
        });
    }

    const checkoutPhone = document.getElementById('checkoutPhone');
    if(checkoutPhone) {
        checkoutPhone.addEventListener('click', () => {
            window.location.href = 'tel:+855719716888';
        });
    }

    updateCartUI();

    function showToast(message) {
        const toast = document.getElementById("toast");
        if (toast) {
            toast.textContent = message;
            toast.className = "toast show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }
    }
});
